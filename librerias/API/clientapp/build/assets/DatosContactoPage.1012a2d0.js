import{H as te}from"./HeaderComponent.0bc9406d.js";import{d as oe}from"./History.e8cf50f5.js";import{r as s,am as ae,aH as ne,A as ie,a as R,b as M,g as le,i as se,h as ce,j as e,G as i,d as a,Y as $,f as de,Z as ue,$ as N,X as U,T as c,an as k,a1 as T,a2 as w,B as I}from"./index.ad9b7e92.js";import{C as me,a as he,b as pe}from"./CardHeader.67279b64.js";import{E as fe}from"./EditOutlined.5e41b408.js";import{D as xe}from"./DeleteOutline.b357c04c.js";import{V as O}from"./ValidationForms.a47614c1.js";import{A as be}from"./Autocompleteasync.c2e150bf.js";import{D as X,a as Y,b as Z,c as J}from"./DialogTitle.c4648013.js";import{D as K}from"./DialogContentText.514f3ba6.js";import{S as ge}from"./SinInformacion.9e7bb934.js";import{E as Ce}from"./Eliminar.18aca338.js";import{S as Ee}from"./SkeletonDynamic.d264f9d2.js";import{H as ve,T as De}from"./Historial-Model.35b6e462.js";import{A as ye}from"./Add.73b42c3e.js";import{T as Se,a as Te}from"./Tabs.f8373235.js";import"./Popper.d79c6681.js";import"./DeleteOutlineOutlined.6e9278a5.js";import"./Stack.9bed6c39.js";const W={id:0,terceroId:0,tipoContactoId:0,nombre:"",numeroDocumento:"",cargo:"",correo:"",direccion:"",ciudad:{id:0,nombre:""},telefono:"",celular:"",isNew:!0},P={nombre:{hasError:!1,msn:""},documento:{hasError:!1,msn:""},email:{hasError:!1,msn:""},telefono:{hasError:!1,msn:""},celular:{hasError:!1,msn:""},direccion:{hasError:!1,msn:""},cargo:{hasError:!1,msn:""},ciudad:{hasError:!1,msn:""}};var p=(o=>(o.Delete="D",o.Edit="E",o.New="New contact",o.Default="F",o))(p||{});const Ie=()=>{const{storeUsuario:o}=s.exports.useContext(ae),[x,E]=s.exports.useState(0),[f,y]=s.exports.useState(1),[v,n]=ne.useState(!1),{showAlert:u,stateAlert:r}=s.exports.useContext(ie),[m,b]=s.exports.useState([]),[j,l]=s.exports.useState(!0),C=s.exports.useRef(),[A,t]=s.exports.useState(),[S,q]=s.exports.useState(),F=(g,h)=>{E(h),y(h+1)},d=()=>{n(!1)},D=async()=>{const g={metodo:`TercerosGI/DatosContacto?TipoContacto=${f}&id=${o.user.idEmpresa}`,AllowAnonymous:!1,type:R.GET},h=await M(g);b(h),l(!1)},ee=(g,h)=>{switch(g){case p.Delete:n(!0);break;case p.New:L(h,p.New);break;case p.Edit:L(h,p.Edit);break}},re=async()=>{var V;l(!0),n(!1);const g={AllowAnonymous:!1,metodo:`TercerosGI/deleteDatoContacto?idContacto=${(V=C.current)==null?void 0:V.id}`,type:R.DELETE},h=await M(g);h!=null&&h.success?(b(_=>[..._].filter(H=>{var z;return H.id!=((z=C.current)==null?void 0:z.id)})),u("Se ha eliminado el contacto exitosamente","Datos de contacto","success")):u("No se pudo eliminar el contacto","Datos de contacto","warning"),l(!1)},L=async(g,h)=>{debugger;l(!0);const V={metodo:"TercerosGI/GuardaDatosContacto",type:R.POST,data:g},_=await M(V);debugger;_!=null&&_.success?(h==p.New?(b([...m,g]),u("Se ha agregado el nuevo contacto exitosamente","Datos de contacto","success")):(b([...m.map(H=>{let z=H;return z.id==g.id&&(z=g),z})]),u("Se ha actualizado el contacto correctamente","Datos de contacto","success")),t(W)):u("No se pudo actualizar el contacto","Datos de contacto","warning"),l(!1)};return s.exports.useEffect(()=>(D(),()=>{}),[]),s.exports.useEffect(()=>(l(!0),D(),()=>{}),[x]),{dataContactos:m,isLoading:j,value:x,openDelete:v,dataEditContacto:S,valueContacto:f,stateAlert:r,handleChange:F,handleCloseDelete:d,handleDeleteContacto:re,dataContactoSelect:C,actionCardContacto:ee,setNewDatosContactos:t}};var G={},Ae=se.exports;Object.defineProperty(G,"__esModule",{value:!0});var Q=G.default=void 0,ze=Ae(le()),ke=ce,Oe=(0,ze.default)((0,ke.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreVert");Q=G.default=Oe;const Be=({contacto:o,onChangeAction:x})=>{const[E,f]=s.exports.useState(null),y=Boolean(E),v=r=>{f(r.currentTarget)},n=()=>{f(null)},u=(r,m)=>{debugger;x({action:r,contacto:m})};return e(i,{item:!0,xs:4,children:a(me,{variant:"outlined",sx:{backgroundColor:"#FBFBFB"},children:[e(he,{sx:{pb:0},action:a($,{children:[e(de,{"aria-label":"settings",color:"primary",onClick:r=>v(r),children:e(Q,{})}),a(ue,{anchorEl:E,id:`tdmenu${o.id}`,open:y,onClose:n,onClick:n,PaperProps:{elevation:0,sx:{width:"214px",overflow:"visible",filter:"drop-shadow(0px 2px 2px rgba(0,0,0,0.22))"}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[a(N,{onClick:()=>u(p.Edit,o),children:[e(U,{children:e(fe,{color:"primary"})}),e(c,{children:"Editar contacto"})]}),a(N,{onClick:()=>u(p.Delete,o),children:[e(U,{children:e(xe,{color:"error"})}),e(c,{color:"error",children:"Eliminar contacto"})]})]})]}),title:o.nombre,titleTypographyProps:{variant:"body1"},subheaderTypographyProps:{variant:"body2"},subheader:o.cargo},o.id),a(pe,{sx:{pt:1},style:{paddingBottom:"0px !important"},children:[a(i,{container:!0,mb:1,p:0,children:[a(i,{item:!0,xs:5,mb:1,p:0,children:[e(c,{m:0,p:0,sx:{fontSize:11},color:"text.secondary",gutterBottom:!0,children:"Numero de documento"}),e(c,{sx:{fontSize:15,mb:0},color:"text.primary",children:o.numeroDocumento}),e(k,{orientation:"vertical",flexItem:!0})]}),e(k,{orientation:"vertical",flexItem:!0}),a(i,{item:!0,xs:6,ml:2,p:0,children:[e(c,{variant:"subtitle2",m:0,p:0,sx:{fontSize:11},color:"text.secondary",gutterBottom:!0,children:"Email"}),e(c,{sx:{fontSize:15,mb:0,wordBreak:"break-all"},color:"text.primary",children:o.correo})]})]}),a(i,{container:!0,mb:1,p:0,children:[a(i,{item:!0,xs:5,mb:1,p:0,children:[e(c,{m:0,p:0,sx:{fontSize:11},color:"text.secondary",gutterBottom:!0,children:"Celular"}),e(c,{sx:{fontSize:15,mb:0},color:"text.primary",children:o.celular}),e(k,{orientation:"vertical",flexItem:!0})]}),e(k,{orientation:"vertical",flexItem:!0}),a(i,{item:!0,xs:5,mb:1,ml:2,p:0,children:[e(c,{m:0,p:0,sx:{fontSize:11},color:"text.secondary",gutterBottom:!0,children:"Celular 2"}),e(c,{sx:{fontSize:15,mb:0},color:"text.primary",children:o.telefono})]})]}),a(i,{container:!0,mb:1,p:0,children:[a(i,{item:!0,xs:5,mb:1,p:0,children:[e(c,{m:0,p:0,sx:{fontSize:11},color:"text.secondary",gutterBottom:!0,children:"Ciudad"}),e(c,{sx:{fontSize:15,mb:0},color:"text.primary",children:o.ciudad.nombre}),e(k,{orientation:"vertical",flexItem:!0})]}),e(k,{orientation:"vertical",flexItem:!0}),a(i,{item:!0,xs:5,mb:1,ml:2,p:0,children:[e(c,{m:0,p:0,sx:{fontSize:11},color:"text.secondary",gutterBottom:!0,children:"Direcci\xF3n"}),e(c,{sx:{fontSize:15,mb:0},color:"text.primary",children:o.direccion})]})]})]})]})})};var B=(o=>(o.add="add",o.edit="edit",o))(B||{});const we=({close:o,newDatosContacto:x,editDatosContacto:E,open:f,tipo:y,_title:v})=>{const[n,u]=s.exports.useState(P),[r,m]=s.exports.useState(y=="add"?W:E),b=()=>{o(!1)},j=t=>{m({...r,ciudad:t})},l=t=>{const{name:S,value:q}=t.target;m(F=>({...F,[S]:q}))},C=()=>{debugger;const t=A();u(t),!(t.cargo.hasError||t.celular.hasError||t.documento.hasError||t.email.hasError||t.nombre.hasError||t.telefono.hasError||t.ciudad.hasError||t.direccion.hasError)&&(u(P),x(r),m(W),b())},A=()=>{let t=P;return r.correo==""?{...t,email:{hasError:!0,msn:"Campo obligatorio"}}:new O().EmailIsValid(r.correo)?r.nombre==""?{...t,nombre:{hasError:!0,msn:"Campo obligatorio"}}:r.cargo==""?{...t,cargo:{hasError:!0,msn:"Campo obligatorio"}}:r.numeroDocumento==""?{...t,documento:{hasError:!0,msn:"Campo obligatorio"}}:new O().OnlyInteger(r.numeroDocumento)?r.celular==""?{...t,celular:{hasError:!0,msn:"Campo obligatorio"}}:new O().OnlyInteger(r.celular)?new O().PhoneValid(r.celular)?r.telefono==""?{...t,telefono:{hasError:!0,msn:"Campo obligatorio"}}:new O().OnlyInteger(r.telefono)?new O().PhoneValid(r.telefono)?r.ciudad.id==0||r.ciudad.nombre==""?{...t,ciudad:{hasError:!0,msn:"Campo obligatorio"}}:t:{...t,celular:{hasError:!0,msn:"Ingrese un celular valido"}}:{...t,celular:{hasError:!0,msn:"Ingrese un celular valido"}}:{...t,celular:{hasError:!0,msn:"Ingrese un celular valido"}}:{...t,celular:{hasError:!0,msn:"Ingrese un celular valido"}}:{...t,documento:{hasError:!0,msn:"Ingrese un documento valido"}}:{...t,email:{hasError:!0,msn:"Ingrese un correo valido"}}};return e($,{children:a(X,{open:f,onClose:b,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"md",children:[e(Y,{id:"alert-dialog-title",children:v}),e(Z,{children:e(K,{id:"alert-dialog-description",children:a(i,{container:!0,spacing:2,width:"100%",display:"flex",alignItems:"center",justifyContent:"center",p:1,children:[e(i,{item:!0,xs:4,children:e(T,{required:!0,id:"",label:"Nombre",name:"nombre",fullWidth:!0,size:"small",onChange:l,value:r==null?void 0:r.nombre,error:n.nombre.hasError,helperText:n.nombre.msn})}),e(i,{item:!0,xs:4,children:e(T,{required:!0,id:"",label:"Numero de documento",name:"numeroDocumento",fullWidth:!0,size:"small",onChange:l,value:r==null?void 0:r.numeroDocumento,error:n.documento.hasError,helperText:n.documento.msn,type:"number"})}),e(i,{item:!0,xs:4,children:e(T,{required:!0,id:"",label:"Email",name:"correo",fullWidth:!0,size:"small",onChange:l,value:r==null?void 0:r.correo,error:n.email.hasError,helperText:n.email.msn,type:"email"})}),e(i,{item:!0,xs:4,children:e(T,{required:!0,id:"",label:"Telefono",name:"telefono",fullWidth:!0,size:"small",onChange:l,value:r==null?void 0:r.telefono,error:n.telefono.hasError,helperText:n.telefono.msn,type:"number"})}),e(i,{item:!0,xs:4,children:e(T,{required:!0,id:"",label:"Celular",name:"celular",fullWidth:!0,size:"small",onChange:l,value:r==null?void 0:r.celular,error:n.celular.hasError,helperText:n.celular.msn,type:"number"})}),e(i,{item:!0,xs:4,children:e(T,{required:!0,id:"",label:"Direccion",name:"direccion",fullWidth:!0,size:"small",onChange:l,value:r==null?void 0:r.direccion,error:n.direccion.hasError,helperText:n.direccion.msn})}),e(i,{item:!0,xs:4,children:e(T,{required:!0,id:"",label:"Cargo",name:"cargo",fullWidth:!0,size:"small",onChange:l,value:r==null?void 0:r.cargo,error:n.cargo.hasError,helperText:n.cargo.msn})}),e(i,{item:!0,xs:4,children:e(be,{label:"Ciudad",method:"Ciudad?filter=",nombreDataOcject:"nombre",showError:n.ciudad,fnSeleted:t=>j(t),defaultValue:r==null?void 0:r.ciudad})}),e(i,{item:!0,xs:4})]})})}),a(J,{children:[e(w,{variant:"outlined",onClick:b,children:"Cancelar"}),e(w,{variant:"contained",color:"primary",onClick:C,autoFocus:!0,children:"Guardar"})]})]})})},Ke=()=>{const o=[{nombre:"Representante legal",id:1},{nombre:"Responsable de pedidos",id:2},{nombre:"Responsable de contratos",id:3},{nombre:"Responsable de actas",id:4},{nombre:"Asesor comercial",id:5},{nombre:"Responsable de cartera",id:6}],{dataContactos:x,isLoading:E,value:f,openDelete:y,valueContacto:v,handleChange:n,handleCloseDelete:u,handleDeleteContacto:r,dataContactoSelect:m,actionCardContacto:b,setNewDatosContactos:j}=Ie(),[l,C]=s.exports.useState(!1),[A,t]=s.exports.useState(B.add),[S,q]=s.exports.useState(!1),F=()=>{q(!0)};return a($,{children:[e(te,{title:`${S?"Historial "+o[f].nombre:""} ${S?"":"Datos contacto"} `}),S?e(ve,{_tipoAuditoria:Object.values(De)[v],onClose:d=>{q(d)}}):a(I,{sx:{width:"100%"},children:[a(I,{display:"flex",justifyContent:"end",pt:"10px",pr:3,children:[a(w,{variant:"text",onClick:()=>{C(!0),t(B.add)},children:[e(ye,{}),"Agregar nuevo contacto"]}),a(w,{variant:"text",onClick:F,children:[" ",e(oe,{sx:{mr:"8px"}}),"Historial"]})]}),e(I,{children:e(Se,{value:f,onChange:n,"aria-label":"basic tabs example",variant:"fullWidth",centered:!0,sx:{borderBottom:1,borderColor:"divider"},children:o.map((d,D)=>e(Te,{label:d.nombre},d.id))})}),e(I,{m:2,children:E?e(Ee,{NoColumnas:4,NoFilas:1,Tipo:"card"}):(x==null?void 0:x.length)==0?e(I,{justifyContent:"center",display:"flex",children:e(ge,{})}):e(I,{sx:{overflow:"auto",maxHeight:"calc(100vh - 17rem)"},children:e(i,{container:!0,spacing:2,children:x.map(d=>e(Be,{contacto:d,onChangeAction:D=>{m.current=D.contacto,D.action==p.Delete&&b(D.action),D.action==p.Edit&&(t(B.edit),console.log(m.current),C(!0))}},d.id))})})})]}),l?e(we,{_title:o[f].nombre,open:l,editDatosContacto:m.current,newDatosContacto:d=>{d.tipoContactoId=v,A==B.edit,console.log(d),b(A==B.add?p.New:p.Edit,d)},tipo:A,close:d=>{C(d)}}):null,a(X,{open:y,onClose:u,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"md",children:[e(Y,{id:"alert-dialog-title",justifyContent:"center",display:"flex",children:a(c,{children:["  ",o[f].nombre," "]})}),e(Z,{children:a(K,{id:"alert-dialog-description",children:[e(I,{justifyContent:"center",display:"flex",children:e(Ce,{})}),e(c,{children:"\xBFEsta seguro que desea eliminar este contacto?"})]})}),a(J,{children:[e(w,{variant:"text",onClick:u,children:"Cancelar"}),e(w,{variant:"outlined",color:"error",onClick:r,autoFocus:!0,children:"Eliminar"})]})]})]})};export{Ke as DatosContactos,Ke as default};
